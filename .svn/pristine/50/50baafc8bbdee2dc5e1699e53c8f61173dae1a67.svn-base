<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
<meta name="format-detection" content="telephone=no" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<title>기안</title>
<link rel="stylesheet" href="<c:url value='../../resources/skin/css/popup.css' />" />
<script type="text/javascript" src="<c:url value='../../resources/skin/js/jquery-1.11.0.min.js' />"></script>
<script>
doAction = function(key) {
	var bizxml = "";
	
/* 	bizxml += "<ns1:start xmlns:ns1=\"http://xmlns.oracle.com/bpel/workflow/task\" xmlns:ns2=\"http://www.example.org\">\n";
	bizxml += "	<ns2:expense>\n";
	bizxml += "		<ns2:expenseNumber>0001</ns2:expenseNumber>\n";
	bizxml += "		<ns2:requesterId>bpmuser1</ns2:requesterId>\n";
	bizxml += "		<ns2:requestDate>2016-03-03T12:00:00</ns2:requestDate>\n";
	bizxml += "		<ns2:amount>10000</ns2:amount>\n"; 
	bizxml += "		<ns2:paymentType>corporation/individual</ns2:paymentType>\n"; 
	bizxml += "		<ns2:expenseType>차량유지비/접대비/복리후생비/출장비</ns2:expenseType>\n"; 
	bizxml += "		<ns2:justification>시스템 장애지원</ns2:justification>\n"; 
	bizxml += "		<ns2:dueDate>2016-03-05T12:00:00</ns2:dueDate>\n"; 
	bizxml += "		<ns2:outcome></ns2:outcome>\r\n"; 
	bizxml += "		<ns2:approval>\r\n";
	bizxml += "			<ns2:line>approvaluser1,approvaluser2</ns2:line>\r\n";
	bizxml += "			<ns2:type>SEQUENTIAL</ns2:type>\r\n";
	bizxml += "			<ns2:ruleset>비용처리승인규칙</ns2:ruleset>\r\n";
	bizxml += "		</ns2:approval>\r\n";
	bizxml += "	</ns2:expense>\r\n";
	bizxml += "</ns1:start>"; */
	
	var expenseNumber = $('#expenseNumber').val();
	var requesterId = $('#requesterId').val();
	var requestDate = $('#requestDate').val();
	var amount = $('#amount').val();
	var paymentType = $('#paymentType').val();
	var expenseType = $('#expenseType').val();
	var justification = $('#justification').val();
	var dueDate = $('#dueDate').val();
	var outcome = key;
	var line = $('#line').val();
	var type = $(':radio[name="type"]:checked').val();
	var ruleset = $('#ruleset').val();
	
	dueDate = dueDate.substring(0,10)+"T"+dueDate.substring(11,16)+":00";
	$("#dueDate").val(dueDate);
	
	bizxml += "<ns1:start xmlns:ns1=\"http://xmlns.oracle.com/bpel/workflow/task\" xmlns:ns2=\"http://www.example.org\">\n";
	bizxml += "	<ns2:expense>\n";
	bizxml += "		<ns2:expenseNumber>"+expenseNumber+"</ns2:expenseNumber>\n";
	bizxml += "		<ns2:requesterId>"+requesterId+"</ns2:requesterId>\n";
	bizxml += "		<ns2:requestDate>"+requestDate+"</ns2:requestDate>\n";
	bizxml += "		<ns2:amount>"+amount+"</ns2:amount>\n"; 
	bizxml += "		<ns2:paymentType>"+paymentType+"</ns2:paymentType>\n"; 
	bizxml += "		<ns2:expenseType>"+expenseType+"</ns2:expenseType>\n"; 
	bizxml += "		<ns2:justification>"+justification+"</ns2:justification>\n"; 
	bizxml += "		<ns2:dueDate>"+dueDate+"</ns2:dueDate>\n"; 
	bizxml += "		<ns2:outcome>"+outcome+"</ns2:outcome>\r\n"; 
	bizxml += "		<ns2:approval>\r\n";
	bizxml += "			<ns2:line>"+line+"</ns2:line>\r\n";
	bizxml += "			<ns2:type>"+type+"</ns2:type>\r\n";
	bizxml += "			<ns2:ruleset>"+ruleset+"</ns2:ruleset>\r\n";
	bizxml += "		</ns2:approval>\r\n";
	bizxml += "	</ns2:expense>\r\n";
	bizxml += "</ns1:start>";
	
	
	$("#outcome").val(outcome);
	$("#body_xml").val(bizxml);

	if(confirm("처리 하시겠습니까?")) {
		document.detail.submit();
	} else return;
}

$(document).ready(function(){
	$('#approvalBtn').click(function(){
		window.open('<spring:url value='/bpm/workflow/approvalList' />','승인자리스트','width=500,height=310');
	});	
});


</script>
</head>

<body>
<div>
	<form name="detail"  method="post" action="<spring:url value="/bpm/workflow/doAction" />" >
	
		<table class="board_reservation_month">
			<tbody>
				<c:choose>
					<c:when test="${requestScope.task.activityName=='법인카드 기안'}">
						<tr>
							<th>승인자지정</th>
							<td><input type="text" id="appList" name="appList" value="" size="50%" readonly/>
								   <input type="button" id="approvalBtn" value="승인자리스트"/></td>
						</tr>
						<tr>
							<th>병렬/순차</th>
							<td>
								<input type="radio" name="type" value="PARALLEL" checked>병렬
								<input type="radio" name="type" value="SEQUENTIAL">순차
							</td>
						</tr>
					</c:when>
				</c:choose>
			</tbody>
		</table>
		<br>
		
		<div class="modal-footer" align="right">
			<c:choose>
				<c:when test="${fn:length(requestScope.task.customActions) > 0}">
					<c:forEach var="action" items="${requestScope.task.customActions}" varStatus="ts">
						<button type="button" class="btn btn-primary" onClick="doAction('${action.key}')">${action.value}</button>
					</c:forEach>
				</c:when>
			</c:choose>
		</div>
		
		<input type="hidden" id="expenseNumber" name="expenseNumber" value="${requestScope.task.textAttribute10}">
		<input type="hidden" id="requesterId" name="requesterId" value="${requestScope.task.textAttribute11}">
		<input type="hidden" id="requestDate" name="requestDate" value="${requestScope.task.dateAttribute1}">
		<input type="hidden" id="amount" name="amount" value="${requestScope.task.numberAttribute1}">
		<input type="hidden" id="paymentType" name="paymentType" value="${requestScope.task.textAttribute12}">
		<input type="hidden" id="expenseType" name="expenseType" value="${requestScope.task.textAttribute13}">
		<input type="hidden" id="justification" name="justification" value="${requestScope.task.textAttribute14}">
		<input type="hidden" id="dueDate" name="dueDate" value="<fmt:formatDate value="${requestScope.task.dateAttribute2.time}" type="date" dateStyle="long" pattern="yyyy-MM-dd HH:mm" />">
		<input type="hidden" id="outcome" name="outcome" value="${requestScope.task.outcome}">
		<input type="hidden" id="line" name="line" value="">
		<input type="hidden" id="ruleset" name="ruleset" value="">

		<textarea id="body_xml" name="body_xml" style="display:none"></textarea>
		<input type="hidden" id="tasknumber" name="tasknumber" value="${requestScope.task.number}">
		<input type="hidden" id="activityName" name="activityName" value="${requestScope.task.activityName}">
		
	</form>
</div>
</body>
</html>